echo_on

function erase
scallbin bin/sst.bin iue 0xbfc00000 0 0xa0000 0x1000
ret

function configddr
m4 0x900000001fe00180 0xff003380
m8 0x900000000ff00000 0x0000006200010001
m8 0x900000000ff00008 0x0000000000000000
m8 0x900000000ff00010 0x0000000000000000
m8 0x900000000ff00018 0x3030303016600000
m8 0x900000000ff00020 0x0202000001010001
m8 0x900000000ff00028 0x0101000002010101
m8 0x900000000ff00030 0x0000000001000202
m8 0x900000000ff00038 0x000000202049292d
m8 0x900000000ff00040 0x0202000001010001
m8 0x900000000ff00048 0x0101000002010101
m8 0x900000000ff00050 0x0000000001000202
m8 0x900000000ff00058 0x0000002020513133
m8 0x900000000ff00060 0x0202000001010000
m8 0x900000000ff00068 0x0101000002010101
m8 0x900000000ff00070 0x0000000101000202
m8 0x900000000ff00078 0x0000002020604031
m8 0x900000000ff00080 0x0202000001010000
m8 0x900000000ff00088 0x0101000002010101
m8 0x900000000ff00090 0x0000000101000202
m8 0x900000000ff00098 0x00000020206a4a35
m8 0x900000000ff000a0 0x0202000001000000
m8 0x900000000ff000a8 0x0101000002010101
m8 0x900000000ff000b0 0x0000000101000202
m8 0x900000000ff000b8 0x00000020207d5d27
m8 0x900000000ff000c0 0x0202000001000100
m8 0x900000000ff000c8 0x0101000002010101
m8 0x900000000ff000d0 0x0000000101000202
m8 0x900000000ff000d8 0x0000002020026236
m8 0x900000000ff000e0 0x0202000001000100
m8 0x900000000ff000e8 0x0101000002010101
m8 0x900000000ff000f0 0x0000000101000202
m8 0x900000000ff000f8 0x0000002020127231
m8 0x900000000ff00100 0x0202000001000100
m8 0x900000000ff00108 0x0101000002010101
m8 0x900000000ff00110 0x0000000101000202
m8 0x900000000ff00118 0x00000020201b7b35
m8 0x900000000ff00120 0x0202000001000000
m8 0x900000000ff00128 0x0101000002010101
m8 0x900000000ff00130 0x0000000002010000
m8 0x900000000ff00138 0x00000020207f6000
m8 0x900000000ff00140 0x0403000001ff01ff
m8 0x900000000ff00148 0x0000000000010100
m8 0x900000000ff00150 0x00000000f0020000
m8 0x900000000ff00158 0x00000196f0000000
m8 0x900000000ff00160 0x000000000f010001
m8 0x900000000ff00168 0x000a00070703030f
m8 0x900000000ff00170 0x8412050048120501
m8 0x900000000ff00178 0x0000000000000000
m8 0x900000000ff00180 0x0001000001100100
m8 0x900000000ff00188 0x0000000000000000
m8 0x900000000ff00190 0x0000000000000000
m8 0x900000000ff00198 0x0000000001000100
m8 0x900000000ff001a0 0x0000001800060d60
m8 0x900000000ff001a8 0x0000001800060d60
m8 0x900000000ff001b0 0x0000001800060d60
m8 0x900000000ff001b8 0x0000001800060d60
m8 0x900000000ff001c0 0x3030c80c03032007
m8 0x900000000ff001c8 0x1f06090903a04004
m8 0x900000000ff001d0 0x0a0209030200001c
m8 0x900000000ff001d8 0x14050c060a080506
m8 0x900000000ff001e0 0x0503000000000000
m8 0x900000000ff001e8 0x0309000000000000
m8 0x900000000ff001f0 0x00080104ff000101
m8 0x900000000ff001f8 0x0000000004081001
m8 0x900000000ff00200 0x0c000c000c000c00
m8 0x900000000ff00208 0x0c000c0000000000
m8 0x900000000ff00210 0x0008000f01010006
m8 0x900000000ff00218 0x0008000f01010006
m8 0x900000000ff00220 0x0008000f01010006
m8 0x900000000ff00228 0x0008000f01010006
m8 0x900000000ff00230 0x0fff000000000000
m8 0x900000000ff00238 0x0ffffe000000ff00
m8 0x900000000ff00240 0x0ffffe000000ff00
m8 0x900000000ff00248 0x0ffffe000000ff00
m8 0x900000000ff00250 0x0000000000000000
m8 0x900000000ff00258 0x0000000000000000
m8 0x900000000ff00260 0x0000000000000000
m8 0x900000000ff00268 0x0000000000000000
m8 0x900000000ff00270 0x01fffc0000000000
m8 0x900000000ff00278 0x0000000000000000
m8 0x900000000ff00280 0x0000000000000000
m8 0x900000000ff00288 0x0000000000000000
m8 0x900000000ff00290 0x0000000000000000
m8 0x900000000ff00298 0x0000000000000000
m8 0x900000000ff002a0 0x0000000000000000
m8 0x900000000ff002a8 0x0000000000000000
m8 0x900000000ff002b0 0x0000000000000000
m8 0x900000000ff002b8 0x0000000000000000
m8 0x900000000ff002c0 0x0000000000000000
m8 0x900000000ff002c8 0x0000000000000000
m8 0x900000000ff002d0 0x0000000000000000
m8 0x900000000ff002d8 0x0000000000000000
m8 0x900000000ff002e0 0x0000000000000000
m8 0x900000000ff002e8 0x0000000000000000
m8 0x900000000ff002f0 0x0000000000000000
m8 0x900000000ff002f8 0x0000000000000000
m8 0x900000000ff00300 0x0000000000000000
m8 0x900000000ff00308 0x0000000000000000
m8 0x900000000ff00310 0x0000000000000000
m8 0x900000000ff00318 0x0000000000000000
m8 0x900000000ff00320 0x0000000000000000
m8 0x900000000ff00328 0x0000000000000000
m8 0x900000000ff00330 0x0000000000000000
m8 0x900000000ff00018 0x3030303016600001
ret


function dumpddr
echo function configddr
echo_on 2
letl conf $(d4q 0x900000001fe00180 1)
m4 0x900000001fe00180 $(expr $conf&~0x10)
echo_off

local i a
let i 0
do while $(expr $i<=0x330)
let a 0x900000000ff00$(expr %%03x $i)
 do if $(expr $i==0x18)
  echo m8 $a $(expr %0x%016llx $(d8q $a 1)&~0x1)
 else
  echo m8 $a $(d8q $a 1)
 end
  let i $(expr $i+0x8)
end
  echo m8 0x900000000ff00018 $(d8q 0x900000000ff00018 1)
echo ret
echo_on
ret

function pci_config_read
pci_config_readv:
local bus dev func reg cnt addr addrp type q
let bus dev func reg cnt  "$1" "$2" "$3" "$4" "$5"
do if $(expr $bus==0)
let addr type $(expr ($dev<<11)|($func<<8)|$reg) 0;
let addrp $(expr 0xffffffffba000000|($addr&0xffff))
else
let addr type $(expr ($bus<<16)|($dev<<11)|($func<<8)|$reg) 0x10000;
let addrp $(expr 0xffffffffbb000000|($addr&0xffff))
end
if $(test $0 == pci_config_read) let q "q"
d4$q $addrp $cnt
ret

function pci_config_write
local bus dev func reg cnt addr type
let bus dev func reg data  "$1" "$2" "$3" "$4" "$5"
do if $(expr $bus==0)
let addr type $(expr ($dev<<11)|($func<<8)|$reg) 0;
let addrp $(expr 0xffffffffba000000|($addr&0xffff))
else
let addr type $(expr ($bus<<16)|($dev<<11)|($func<<8)|$reg) 0x10000;
let addrp $(expr 0xffffffffbb000000|($addr&0xffff))
end
m4 $addrp $data
ret


function cachelock
m8 0x900000003ff00200  0x8000000000000000
m8 0x900000003ff00240  0xfffffffffffc0000
ret

function ddrinit
letl t0 $(expr $(cp0s 1 d8q 15 1)&0x3ff)
letl a0 0x9800000000000000
#coreid
letl t1 $(expr $t0&0x3)
letl t2 $(expr $t1<<18)
letl a0 $(expr $t2|$a0)
#nodeid
letl t2 $(expr $t0&0xc)
letl t2 $(expr $t2<<42)
letl a0 $(expr $a0|$t2)
echo $t0 $a0

letl  t0 0xffffffffbfe00180
letl  a2 $(d4q $t0 1)
letl  a2 $(expr $a2&(~0x1080))
m4 $t0 $a2
letl a2  $(expr $a2|0x1080)
m4 $t0 $a2

cp0s
m4 29 0
m4 28 0
mems

setconfig cacheflush.nohelp_size 0x10000
cache 0xa 0x9800000000000000 0x4000
cache 0xa 0x9800000000000001 0x4000
cache 0xa 0x9800000000000002 0x4000
cache 0xa 0x9800000000000003 0x4000
cache 0xa 0x9800000000000004 0x4000
cache 0xa 0x9800000000000005 0x4000
cache 0xa 0x9800000000000006 0x4000
cache 0xa 0x9800000000000007 0x4000
cp0s 0 m8 26 0x22
cache 0xb 0x9800000000000000 0x4000

ret

function cacheinit
cp0s 0 m4 29 0
cp0s 0 m4 28 0
setconfig cacheflush.nohelp_size 0x10000
cache 0xa 0x9800000000000000 0x4000
cache 0xa 0x9800000000000001 0x4000
cache 0xa 0x9800000000000002 0x4000
cache 0xa 0x9800000000000003 0x4000
cache 0xa 0x9800000000000004 0x4000
cache 0xa 0x9800000000000005 0x4000
cache 0xa 0x9800000000000006 0x4000
cache 0xa 0x9800000000000007 0x4000
cp0s 0 m8 26 0x22
cache 0xb 0x9800000000000000 0x4000
cache 5 0x9800000000000000 0x4000
cache 5 0x9800000000000001 0x4000
cache 5 0x9800000000000002 0x4000
cache 5 0x9800000000000003 0x4000
cp0s 0 m8 26 0
cache 8 0x9800000000000000 0x4000
cache 8 0x9800000000000001 0x4000
cache 8 0x9800000000000002 0x4000
cache 8 0x9800000000000003 0x4000
ret
function configxbar
m8 0x900000003ff02000 0x0000000018000000
m8 0x900000003ff02008 0x00000c0000000000
m8 0x900000003ff02010 0x0000000000000000
m8 0x900000003ff02018 0x0000000040000000
m8 0x900000003ff02020 0x000000001e000000
m8 0x900000003ff02028 0x0000200000000000
m8 0x900000003ff02030 0x0000000000000000
m8 0x900000003ff02038 0x0000080000000000
m8 0x900000003ff02040 0xfffffffffc000000
m8 0x900000003ff02048 0xfffffc0000000000
m8 0x900000003ff02050 0x0000000000000000
m8 0x900000003ff02058 0xffffffffc0000000
m8 0x900000003ff02060 0xffffffffff000000
m8 0x900000003ff02068 0x0000200000000000
m8 0x900000003ff02070 0x0000000000000000
m8 0x900000003ff02078 0x0000080000000000
m8 0x900000003ff02080 0x00001efdfc0000f4
m8 0x900000003ff02088 0x00001c00000000f4
m8 0x900000003ff02090 0x0000000000000000
m8 0x900000003ff02098 0x00001e00400000f4
m8 0x900000003ff020a0 0x00001e00000000f4
m8 0x900000003ff020a8 0x00002000000000f4
m8 0x900000003ff020b0 0x0000000000000000
m8 0x900000003ff020b8 0x00000800000000f4
m8 0x900000003ff02700 0x0000000000000000
m8 0x900000003ff02708 0x0000000000000000
m8 0x900000003ff02710 0x0000000000000000
m8 0x900000003ff02718 0x0000000000000000
m8 0x900000003ff02720 0x0000000000000000
m8 0x900000003ff02728 0x0000000000000000
m8 0x900000003ff02730 0x0000000000000000
m8 0x900000003ff02738 0x0000000000000000
m8 0x900000003ff02740 0x0000000000000000
m8 0x900000003ff02748 0x0000000000000000
m8 0x900000003ff02750 0x0000000000000000
m8 0x900000003ff02758 0x0000000000000000
m8 0x900000003ff02760 0x0000000000000000
m8 0x900000003ff02768 0x0000000000000000
m8 0x900000003ff02770 0x0000000000000000
m8 0x900000003ff02778 0x0000000000000000
m8 0x900000003ff02780 0x0000000000000000
m8 0x900000003ff02788 0x0000000000000000
m8 0x900000003ff02790 0x0000000000000000
m8 0x900000003ff02798 0x0000000000000000
m8 0x900000003ff027a0 0x0000000000000000
m8 0x900000003ff027a8 0x0000000000000000
m8 0x900000003ff027b0 0x0000000000000000
m8 0x900000003ff027b8 0x0000000000000000
m8 0x900000003ff00000 0x000000001fc00000
m8 0x900000003ff00008 0x0000000010000000
m8 0x900000003ff00010 0x0000000000000000
m8 0x900000003ff00018 0x0000000000000000
m8 0x900000003ff00020 0x0000000080000000
m8 0x900000003ff00028 0x0000000100000000
m8 0x900000003ff00030 0x0000000000000000
m8 0x900000003ff00038 0x0000000000000000
m8 0x900000003ff00040 0xfffffffffff00000
m8 0x900000003ff00048 0xfffffffff0000000
m8 0x900000003ff00050 0xfffffffff0000000
m8 0x900000003ff00058 0x0000000000000000
m8 0x900000003ff00060 0xffffffff80000000
m8 0x900000003ff00068 0xffffffff80000000
m8 0x900000003ff00070 0x0000000000000000
m8 0x900000003ff00078 0x0000000000000000
m8 0x900000003ff00080 0x000000001fc000f2
m8 0x900000003ff00088 0x0000000010000082
m8 0x900000003ff00090 0x00000000000000f0
m8 0x900000003ff00098 0x0000000000000000
m8 0x900000003ff000a0 0x00000000000000f0
m8 0x900000003ff000a8 0x00000000800000f0
m8 0x900000003ff000b0 0x0000000000000000
m8 0x900000003ff000b8 0x0000000000000000
m8 0x900000003ff00100 0x0000000080000000
m8 0x900000003ff00108 0x0000000000000000
m8 0x900000003ff00110 0x0000000080000000
m8 0x900000003ff00118 0x0000000000000000
m8 0x900000003ff00120 0x0000000080000000
m8 0x900000003ff00128 0x0000000100000000
m8 0x900000003ff00130 0x0000000000000000
m8 0x900000003ff00138 0x0000000000000000
m8 0x900000003ff00140 0xffffffff80000000
m8 0x900000003ff00148 0x0000000000000000
m8 0x900000003ff00150 0xfffffffff0000000
m8 0x900000003ff00158 0x0000000000000000
m8 0x900000003ff00160 0xffffffff80000000
m8 0x900000003ff00168 0xffffffff80000000
m8 0x900000003ff00170 0x0000000000000000
m8 0x900000003ff00178 0x0000000000000000
m8 0x900000003ff00180 0x0000000000000000
m8 0x900000003ff00188 0x0000000000000000
m8 0x900000003ff00190 0x00000000000000f0
m8 0x900000003ff00198 0x0000000000000000
m8 0x900000003ff001a0 0x00000000000000f0
m8 0x900000003ff001a8 0x00000000800000f0
m8 0x900000003ff001b0 0x0000000000000000
m8 0x900000003ff001b8 0x0000000000000000
m8 0x90000efdfb000000 0x0000000000000000
m8 0x90000efdfb000060 0x0080fff0c0000000
m8 0x90000efdfb000068 0x0000e000c0000000
m8 0x90000efdfb000070 0x2000e000c0100000
ret

function mytest
setconfig core.nocache 0
setconfig core.abisize 64
call configddr
#call configxbar
call cacheinit
call cachelock
ret
function tmp
setconfig core.nocache 1
setconfig helpaddr  0x9800000000000000
setconfig put.pack_size 0x10000
put /work/ls3b/gzrom.bin 0x9800000000001000
setconfig callbin.stacksize 0x1000
Scallbin bin/caclfreq.bin64
ret

setconfig core.cpucount 8
setconfig core.cpuwidth 64
#setconfig core.abisize 64
usblooptest 0x81000070 0x10010
#selectcore 0xf
setconfig spi.iobase 0xffffffffbfe00220
setconfig flash.type byte

